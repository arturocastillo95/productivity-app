{"ast":null,"code":"import _toConsumableArray from\"/Users/arturocastillo/developer/productivity-app/src/productivityreact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/arturocastillo/developer/productivity-app/src/productivityreact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from'react';import{SortableContainer,SortableElement}from'react-sortable-hoc';import arrayMove from'array-move';function getCookie(name){var cookieValue=null;if(document.cookie&&document.cookie!==''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=cookies[i].trim();// Does this cookie string begin with the name we want?\nif(cookie.substring(0,name.length+1)===name+'='){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}return cookieValue;}function fancyTimeFormat(duration){// Hours, minutes and seconds\nvar hrs=~~(duration/3600);var mins=~~(duration%3600/60);var secs=~~duration%60;// Output like \"1:01\" or \"4:03:59\" or \"123:03:59\"\nvar ret=\"\";if(hrs>0){ret+=\"\"+hrs+\":\"+(mins<10?\"0\":\"\");}ret+=\"\"+mins+\":\"+(secs<10?\"0\":\"\");ret+=\"\"+secs;return ret;}var Timer=function Timer(_ref){var seconds=_ref.seconds,onTimeUpdate=_ref.onTimeUpdate;// initialize timeLeft with the seconds prop\nvar _useState=useState(seconds),_useState2=_slicedToArray(_useState,2),timeLeft=_useState2[0],setTimeLeft=_useState2[1];useEffect(function(){// exit early when we reach 0\nif(!timeLeft)return;// save intervalId to clear the interval when the\n// component re-renders\nvar intervalId=setInterval(function(){if(timeLeft>0){setTimeLeft(timeLeft-1);onTimeUpdate(timeLeft);}},1000);// clear interval on re-render to avoid memory leaks\nreturn function(){return clearInterval(intervalId);};// add timeLeft as a dependency to re-rerun the effect\n// when we update it\n},[timeLeft]);useEffect(function(){setTimeLeft(seconds);},[seconds]);return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",{className:\"has-text-success\"},fancyTimeFormat(timeLeft)));};var StartTimer=function StartTimer(_ref2){var value=_ref2.value,onTimerStart=_ref2.onTimerStart,onTimerPause=_ref2.onTimerPause;var _useState3=useState({'state':'paused','seconds':'0'}),_useState4=_slicedToArray(_useState3,2),timer=_useState4[0],setTimer=_useState4[1];var _useContext=useContext(ActiveTask),active=_useContext.active,setActive=_useContext.setActive;function startTimer(){setTimer({'state':'running','seconds':value.remaining});setActive(true);onTimerStart();}function pauseTimer(){setTimer({'state':'paused','seconds':'0'});setActive(false);onTimerPause();}function timeUpdate(s){var url='http://127.0.0.1:8000/api/task-update/'+value.id+'/';var csrf_token=getCookie('csrftoken');var new_remaining=value;new_remaining.remaining=s;fetch(url,{'method':'POST','headers':{'Content-Type':'application/json','X-CSRFToken':csrf_token},'body':JSON.stringify(value)});}return/*#__PURE__*/React.createElement(\"div\",{className:\"level-item\"},timer.state==='paused'&&active===false&&/*#__PURE__*/React.createElement(\"a\",{href:\"/#\",onClick:startTimer},/*#__PURE__*/React.createElement(\"span\",{className:\"icon has-text-success\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-play\"}))),timer.state==='running'&&/*#__PURE__*/React.createElement(\"a\",{href:\"/#\",onClick:pauseTimer},/*#__PURE__*/React.createElement(\"span\",{className:\"icon has-text-success\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-pause\"}))),timer.state==='running'&&/*#__PURE__*/React.createElement(Timer,{seconds:timer.seconds,onTimeUpdate:timeUpdate}));};var SortableItem=SortableElement(function(_ref3){var value=_ref3.value,onActivateTask=_ref3.onActivateTask;var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),active_style=_useState6[0],setActiveStyle=_useState6[1];function timerStarted(){onActivateTask(value.id);setActiveStyle(true);}return/*#__PURE__*/React.createElement(\"li\",{className:\"box \"+(active_style?'task-is-active':'')},/*#__PURE__*/React.createElement(\"div\",{className:\"level is-mobile\"},/*#__PURE__*/React.createElement(\"div\",{className:\"level-left\"},/*#__PURE__*/React.createElement(\"input\",{type:\"checkbox\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"level-item\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"title is-5\"},value.title)),/*#__PURE__*/React.createElement(\"div\",{className:\"level-right\"},/*#__PURE__*/React.createElement(StartTimer,{value:value,onTimerStart:timerStarted,onTimerPause:function onTimerPause(){return setActiveStyle(false);}}),/*#__PURE__*/React.createElement(\"div\",{className:\"level-item\"},/*#__PURE__*/React.createElement(\"a\",{href:\"\"},/*#__PURE__*/React.createElement(\"span\",{className:\"icon has-text-warning\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-edit\"})))))));});var SortableComponent=SortableContainer(function(_ref4){var items=_ref4.items,onFocusTask=_ref4.onFocusTask;function setActiveTask(taskId){var index=items.findIndex(function(i){return i.id===taskId;});onFocusTask(index);}return/*#__PURE__*/React.createElement(\"ul\",null,items.map(function(value,index){return/*#__PURE__*/React.createElement(SortableItem,{key:value.id,index:index,value:value,onActivateTask:setActiveTask});}));});// Context\nexport var ActiveTask=React.createContext(false);export default function SortableList(_ref5){var refreshList=_ref5.refreshList;var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),tasks=_useState8[0],setTasks=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),active=_useState10[0],setActive=_useState10[1];var active_task={active:active,setActive:setActive};useEffect(function(){fetch('http://127.0.0.1:8000/api/task-list/').then(function(response){return response.json();}).then(function(data){data.sort(function(a,b){return a.order>b.order?1:b.order>a.order?-1:0;});if(refreshList.title){var current_index=data.findIndex(function(i){return i.title===refreshList.title&&i.remaining===refreshList.remaining;});data=arrayMove(data,current_index,0);}setTasks(data);});// return () => {\n//     cleanup\n// };\n},[refreshList]);var onSortEnd=function onSortEnd(_ref6){var oldIndex=_ref6.oldIndex,newIndex=_ref6.newIndex;var newOrder=_toConsumableArray(tasks);newOrder=arrayMove(newOrder,oldIndex,newIndex);newOrder.forEach(function(task,index){var url='http://127.0.0.1:8000/api/task-update/'+task.id+'/';var csrf_token=getCookie('csrftoken');task.order=index;fetch(url,{'method':'POST','headers':{'Content-Type':'application/json','X-CSRFToken':csrf_token},'body':JSON.stringify(task)});});setTasks(newOrder);};function focusTask(taskIndex){var focusTask=tasks[taskIndex];var newOrder=tasks;newOrder.splice(taskIndex,1);newOrder.unshift(focusTask);setTasks(newOrder);}return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ActiveTask.Provider,{value:active_task},/*#__PURE__*/React.createElement(SortableComponent,{items:tasks,onSortEnd:onSortEnd,onFocusTask:focusTask})));}","map":{"version":3,"sources":["/Users/arturocastillo/developer/productivity-app/src/productivityreact/src/components/SortableList.js"],"names":["React","useState","useEffect","useContext","SortableContainer","SortableElement","arrayMove","getCookie","name","cookieValue","document","cookie","cookies","split","i","length","trim","substring","decodeURIComponent","fancyTimeFormat","duration","hrs","mins","secs","ret","Timer","seconds","onTimeUpdate","timeLeft","setTimeLeft","intervalId","setInterval","clearInterval","StartTimer","value","onTimerStart","onTimerPause","timer","setTimer","ActiveTask","active","setActive","startTimer","remaining","pauseTimer","timeUpdate","s","url","id","csrf_token","new_remaining","fetch","JSON","stringify","state","SortableItem","onActivateTask","active_style","setActiveStyle","timerStarted","title","SortableComponent","items","onFocusTask","setActiveTask","taskId","index","findIndex","map","createContext","SortableList","refreshList","tasks","setTasks","active_task","then","response","json","data","sort","a","b","order","current_index","onSortEnd","oldIndex","newIndex","newOrder","forEach","task","focusTask","taskIndex","splice","unshift"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useContext} from 'react'\nimport {SortableContainer, SortableElement} from 'react-sortable-hoc';\nimport arrayMove from 'array-move';\n\nfunction getCookie(name) {\n    let cookieValue = null;\n    if (document.cookie && document.cookie !== '') {\n        const cookies = document.cookie.split(';');\n        for (let i = 0; i < cookies.length; i++) {\n            const cookie = cookies[i].trim();\n            // Does this cookie string begin with the name we want?\n            if (cookie.substring(0, name.length + 1) === (name + '=')) {\n                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n                break;\n            }\n        }\n    }\n    return cookieValue;\n}\n\n\nfunction fancyTimeFormat(duration)\n{   \n    // Hours, minutes and seconds\n    var hrs = ~~(duration / 3600);\n    var mins = ~~((duration % 3600) / 60);\n    var secs = ~~duration % 60;\n\n    // Output like \"1:01\" or \"4:03:59\" or \"123:03:59\"\n    var ret = \"\";\n\n    if (hrs > 0) {\n        ret += \"\" + hrs + \":\" + (mins < 10 ? \"0\" : \"\");\n    }\n\n    ret += \"\" + mins + \":\" + (secs < 10 ? \"0\" : \"\");\n    ret += \"\" + secs;\n    return ret;\n}\n\nconst Timer = ({ seconds, onTimeUpdate }) => {\n    // initialize timeLeft with the seconds prop\n    const [timeLeft, setTimeLeft] = useState(seconds);\n  \n    useEffect(() => {\n      // exit early when we reach 0\n        if (!timeLeft) return;\n\n      // save intervalId to clear the interval when the\n      // component re-renders\n        const intervalId = setInterval(() => {\n        if (timeLeft > 0) {\n            setTimeLeft(timeLeft - 1);\n            onTimeUpdate(timeLeft)\n        }\n        }, 1000);\n  \n      // clear interval on re-render to avoid memory leaks\n        return () => clearInterval(intervalId);\n      // add timeLeft as a dependency to re-rerun the effect\n      // when we update it\n    }, [timeLeft]);\n\n    useEffect(() => {\n        setTimeLeft(seconds)\n    }, [seconds])\n\n    return (\n    <div>\n        <h1 className='has-text-success'>{fancyTimeFormat(timeLeft)}</h1>\n    </div>\n    );\n    };\n\n\n\nconst StartTimer = ({ value, onTimerStart, onTimerPause }) => {\n\n    const [timer, setTimer] = useState({'state': 'paused', 'seconds': '0'});\n    const {active, setActive} = useContext(ActiveTask);\n\n    function startTimer() {\n        setTimer({'state': 'running', 'seconds': value.remaining});\n        setActive(true);\n        onTimerStart();\n    }\n\n    function pauseTimer() {\n        setTimer({'state': 'paused', 'seconds': '0'});\n        setActive(false);\n        onTimerPause();\n    }\n\n    function timeUpdate(s) {\n        var url = 'http://127.0.0.1:8000/api/task-update/' + value.id + '/';\n        var csrf_token = getCookie('csrftoken');\n\n        var new_remaining = value\n        new_remaining.remaining = s\n\n        fetch(url, {\n            'method': 'POST',\n            'headers': {\n                'Content-Type': 'application/json',\n                'X-CSRFToken': csrf_token,\n            },\n            'body': JSON.stringify(value)\n            });\n\n        }\n    \n    \n    return (\n        <div className=\"level-item\">\n\n            {timer.state === 'paused' && active === false &&\n            <a href=\"/#\" onClick={startTimer}>\n                <span className=\"icon has-text-success\">\n                    <i className=\"fas fa-play\"></i>\n                </span>\n            </a>\n            }\n            \n            {timer.state === 'running' &&\n            <a href=\"/#\" onClick={pauseTimer}>\n                <span className=\"icon has-text-success\">\n                    <i className=\"fas fa-pause\"></i>\n                </span>\n            </a>\n            }\n\n            {timer.state === 'running' && \n            <Timer seconds={timer.seconds} onTimeUpdate={timeUpdate}/>\n            }\n\n        </div>\n    )\n}\n\n\n\nconst SortableItem = SortableElement(({value, onActivateTask}) => {\n    const [active_style, setActiveStyle] = useState(false)\n\n    function timerStarted() {\n        onActivateTask(value.id);\n        setActiveStyle(true);\n    }\n\n    return (\n        <li className={\"box \" + (active_style ? 'task-is-active': '')}>\n            <div className=\"level is-mobile\">\n                <div className=\"level-left\">\n                    <input type=\"checkbox\"/>\n                </div>\n\n                <div className=\"level-item\">\n                    <h1 className=\"title is-5\">\n                        {value.title}\n                    </h1>\n                </div>\n\n                <div className=\"level-right\">\n\n                    <StartTimer value={value} onTimerStart={timerStarted} onTimerPause={() => setActiveStyle(false)}/>\n\n                    <div className=\"level-item\">\n                        <a href=\"\">\n                            <span className=\"icon has-text-warning\">\n                                <i className=\"fas fa-edit\"></i>\n                            </span>\n                        </a>\n                    </div>\n                </div>\n\n            </div>\n        </li>\n    )\n});\n\nconst SortableComponent = SortableContainer(({items, onFocusTask}) => {\n\n    function setActiveTask(taskId) {\n        var index = items.findIndex(i => i.id === taskId);\n        onFocusTask(index);\n    }\n\n    return (\n    <ul>\n        {items.map((value, index) => (\n          <SortableItem key={value.id} index={index} value={value} onActivateTask={setActiveTask}/>\n        ))}\n      </ul>\n    )\n})\n\n\n// Context\nexport const ActiveTask = React.createContext(false)\n\nexport default function SortableList({ refreshList }) {\n    const [tasks, setTasks] = useState([]);\n    const [active, setActive] = useState(false);\n    const active_task = {active, setActive};\n\n    useEffect(() => {\n        fetch('http://127.0.0.1:8000/api/task-list/')\n        .then(response => response.json())\n        .then(data => {\n            data.sort((a, b) => (a.order > b.order) ? 1 : ((b.order > a.order) ? -1 : 0));\n            if (refreshList.title) {\n                var current_index = data.findIndex(i => i.title === refreshList.title && i.remaining === refreshList.remaining);\n                data = arrayMove(data, current_index, 0);\n            }\n            setTasks(data);\n            }\n        )\n        // return () => {\n        //     cleanup\n        // };\n    }, [refreshList]);\n\n    const onSortEnd =  ({oldIndex, newIndex}) => {\n        var newOrder = [...tasks];\n        newOrder = arrayMove(newOrder, oldIndex, newIndex);\n                        \n        newOrder.forEach((task, index) => {\n            var url = 'http://127.0.0.1:8000/api/task-update/' + task.id + '/'\n            var csrf_token = getCookie('csrftoken');\n            task.order = index;\n\n            fetch(url, {\n                'method': 'POST',\n                'headers': {\n                    'Content-Type': 'application/json',\n                    'X-CSRFToken': csrf_token,\n                },\n                'body': JSON.stringify(task)\n            })\n\n\n        })\n\n        setTasks(newOrder)\n\n    }\n\n    function focusTask(taskIndex) {\n        var focusTask = tasks[taskIndex];\n        var newOrder = tasks;\n        newOrder.splice(taskIndex, 1);\n        newOrder.unshift(focusTask);\n\n        setTasks(newOrder)\n\n    }\n\n    return (\n        <>\n        <ActiveTask.Provider value={active_task}>\n            <SortableComponent items={tasks} onSortEnd={onSortEnd} onFocusTask={focusTask}/>\n        </ActiveTask.Provider>\n        </>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}