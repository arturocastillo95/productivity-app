{"ast":null,"code":"import _toConsumableArray from\"/Users/arturocastillo/developer/productivity-app/src/productivityreact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/arturocastillo/developer/productivity-app/src/productivityreact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/arturocastillo/developer/productivity-app/src/productivityreact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/arturocastillo/developer/productivity-app/src/productivityreact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import{SortableContainer,SortableElement}from'react-sortable-hoc';import arrayMove from'array-move';import{getCookie,taskUpdate,fancyTimeFormat}from'./utils';import{StartTimer}from'./Timer';import{BASE_URL}from'./../App';var SortableItem=SortableElement(function(_ref){var value=_ref.value,onActivateTask=_ref.onActivateTask,onDeleteTask=_ref.onDeleteTask,onFinishedTask=_ref.onFinishedTask,onEditTask=_ref.onEditTask;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),active_style=_useState2[0],setActiveStyle=_useState2[1];function timerStarted(){onActivateTask(value.id);setActiveStyle(true);}function markAsComplete(){setActiveStyle(false);onFinishedTask(value);}return/*#__PURE__*/React.createElement(\"li\",{className:\"box \"+(active_style?'task-is-active':'')},/*#__PURE__*/React.createElement(\"div\",{className:\"level is-mobile\"},/*#__PURE__*/React.createElement(\"div\",{className:\"level-left\"},/*#__PURE__*/React.createElement(\"input\",{className:\" \"+(value.completed?'is-hidden':''),type:\"checkbox\",onChange:function onChange(){return onFinishedTask(value);}})),/*#__PURE__*/React.createElement(\"div\",{className:\"level-item\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",{className:\"title is-5 \"+(value.completed?'is-completed':'')},value.title),active_style===false&&/*#__PURE__*/React.createElement(\"p\",{className:\"is-help has-text-centered\"},fancyTimeFormat(value.remaining)))),/*#__PURE__*/React.createElement(\"div\",{className:\"level-right\"},/*#__PURE__*/React.createElement(StartTimer,{value:value,onTimerStart:timerStarted,onTimerPause:function onTimerPause(){return setActiveStyle(false);},markAsComplete:markAsComplete}),active_style===false&&/*#__PURE__*/React.createElement(\"div\",{className:\"level-item \"+(value.completed?'is-hidden':''),onClick:function onClick(e){return onEditTask(value);}},/*#__PURE__*/React.createElement(\"a\",{href:\"#/\"},/*#__PURE__*/React.createElement(\"span\",{className:\"icon has-text-warning\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-edit\"})))),/*#__PURE__*/React.createElement(\"div\",{className:\"level-item\"},/*#__PURE__*/React.createElement(\"a\",{href:\"#/\",onClick:function onClick(e){return onDeleteTask(value);}},/*#__PURE__*/React.createElement(\"span\",{className:\"icon has-text-danger\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-lg fa-times\"})))))));});var SortableComponent=SortableContainer(function(_ref2){var items=_ref2.items,onFocusTask=_ref2.onFocusTask,onDeleteTask=_ref2.onDeleteTask,onFinishedTask=_ref2.onFinishedTask,onEditTask=_ref2.onEditTask;function setActiveTask(taskId){var index=items.findIndex(function(i){return i.id===taskId;});onFocusTask(index);}return/*#__PURE__*/React.createElement(\"ul\",null,items.map(function(value,index){return/*#__PURE__*/React.createElement(SortableItem,{key:value.id,index:index,value:value,onActivateTask:setActiveTask,onDeleteTask:onDeleteTask,onFinishedTask:onFinishedTask,onEditTask:onEditTask});}));});// Context for setting active tasks\nexport var ActiveTask=React.createContext(false);export default function SortableList(_ref3){var newTaskCreated=_ref3.newTaskCreated,completedTasksList=_ref3.completedTasksList,onEditTask=_ref3.onEditTask,onUpdateTasks=_ref3.onUpdateTasks,onSort=_ref3.onSort;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),tasks=_useState4[0],setTasks=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),active=_useState6[0],setActive=_useState6[1];var active_task={active:active,setActive:setActive};var isInitialMount=useRef(true);var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),isLoading=_useState8[0],setLoading=_useState8[1];var fetchTasks=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:url=BASE_URL+'api/task-list/'+(completedTasksList?'completed/':'active/');_context.prev=1;_context.next=4;return fetch(url);case 4:response=_context.sent;return _context.abrupt(\"return\",response.ok?response.json():null);case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.log(_context.t0);return _context.abrupt(\"return\",null);case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function fetchTasks(){return _ref4.apply(this,arguments);};}();function updateIndex(data){var csrf_token=getCookie('csrftoken');data.forEach(function(task,index){task.order=index;taskUpdate(task,csrf_token);});};useEffect(function(){switch(onSort){default:break;case'longest':var sorted=_toConsumableArray(tasks);sorted.sort(function(a,b){return a.remaining<b.remaining?1:b.remaining<a.remaining?-1:0;});setTasks(sorted);break;case'shortest':var sorted=_toConsumableArray(tasks);sorted.sort(function(a,b){return a.remaining>b.remaining?1:b.remaining>a.remaining?-1:0;});setTasks(sorted);break;}},[onSort]);//Update list when new task is created\nuseEffect(function(){if(isInitialMount.current){isInitialMount.current=false;}else{fetchTasks().then(function(data){data.sort(function(a,b){return a.order>b.order?1:b.order>a.order?-1:0;});var index=data.findIndex(function(i){return i.title===newTaskCreated.title;});data=arrayMove(data,index,0);data.forEach(function(value,i){value.order=i;});setTasks(data);updateIndex(data);});}},[newTaskCreated]);useEffect(function(){fetchTasks().then(function(data){data.sort(function(a,b){return a.order>b.order?1:b.order>a.order?-1:0;});setTasks(data);setLoading(false);});},[onUpdateTasks]);var onSortEnd=function onSortEnd(_ref5){var oldIndex=_ref5.oldIndex,newIndex=_ref5.newIndex;var newOrder=_toConsumableArray(tasks);newOrder=arrayMove(newOrder,oldIndex,newIndex);updateIndex(newOrder);setTasks(newOrder);};function deleteTask(e){var newTasks=tasks.filter(function(i){return i.id!==e.id;});setTasks(newTasks);var csrf_token=getCookie('csrftoken');var url=BASE_URL+'api/task-delete/'+e.id+'/';fetch(url,{method:'DELETE',headers:{'Content-Type':'application/json','X-CSRFToken':csrf_token}});}function getCurrentDate(){var date=new Date();var dd=String(date.getDate()).padStart(2,'0');var mm=String(date.getMonth()+1).padStart(2,'0');var year=date.getFullYear();var today=year+'-'+mm+'-'+dd;return today;}function markTaskAsComplete(e){var index=tasks.findIndex(function(i){return i.id===e.id;});var updates=_toConsumableArray(tasks);updates[index].completed=true;updates[index].finish_date=getCurrentDate();var csrf_token=getCookie('csrftoken');setTasks(updates);taskUpdate(updates[index],csrf_token);}function focusTask(taskIndex){var newOrder=arrayMove(tasks,taskIndex,0);setTasks(newOrder);};return/*#__PURE__*/React.createElement(React.Fragment,null,isLoading===true&&/*#__PURE__*/React.createElement(\"div\",{className:\"lds-ellipsis\"},/*#__PURE__*/React.createElement(\"div\",null),/*#__PURE__*/React.createElement(\"div\",null),/*#__PURE__*/React.createElement(\"div\",null),/*#__PURE__*/React.createElement(\"div\",null)),isLoading===false&&/*#__PURE__*/React.createElement(ActiveTask.Provider,{value:active_task},/*#__PURE__*/React.createElement(SortableComponent,{items:tasks,onSortEnd:onSortEnd,onFocusTask:focusTask,onDeleteTask:deleteTask,onFinishedTask:markTaskAsComplete,onEditTask:onEditTask})));}","map":{"version":3,"sources":["/Users/arturocastillo/developer/productivity-app/src/productivityreact/src/components/SortableList.js"],"names":["React","useState","useEffect","useRef","SortableContainer","SortableElement","arrayMove","getCookie","taskUpdate","fancyTimeFormat","StartTimer","BASE_URL","SortableItem","value","onActivateTask","onDeleteTask","onFinishedTask","onEditTask","active_style","setActiveStyle","timerStarted","id","markAsComplete","completed","title","remaining","e","SortableComponent","items","onFocusTask","setActiveTask","taskId","index","findIndex","i","map","ActiveTask","createContext","SortableList","newTaskCreated","completedTasksList","onUpdateTasks","onSort","tasks","setTasks","active","setActive","active_task","isInitialMount","isLoading","setLoading","fetchTasks","url","fetch","response","ok","json","console","log","updateIndex","data","csrf_token","forEach","task","order","sorted","sort","a","b","current","then","onSortEnd","oldIndex","newIndex","newOrder","deleteTask","newTasks","filter","method","headers","getCurrentDate","date","Date","dd","String","getDate","padStart","mm","getMonth","year","getFullYear","today","markTaskAsComplete","updates","finish_date","focusTask","taskIndex"],"mappings":"yvBAAA,MAAOA,CAAAA,KAAP,EAAeC,QAAf,CAAyBC,SAAzB,CAAoCC,MAApC,KAAiD,OAAjD,CACA,OAAQC,iBAAR,CAA2BC,eAA3B,KAAiD,oBAAjD,CACA,MAAOC,CAAAA,SAAP,KAAsB,YAAtB,CACA,OAAQC,SAAR,CAAmBC,UAAnB,CAA8BC,eAA9B,KAAoD,SAApD,CACA,OAAQC,UAAR,KAAyB,SAAzB,CACA,OAAQC,QAAR,KAAuB,UAAvB,CAGA,GAAMC,CAAAA,YAAY,CAAGP,eAAe,CAAC,cAAuE,IAArEQ,CAAAA,KAAqE,MAArEA,KAAqE,CAA9DC,cAA8D,MAA9DA,cAA8D,CAA9CC,YAA8C,MAA9CA,YAA8C,CAAhCC,cAAgC,MAAhCA,cAAgC,CAAhBC,UAAgB,MAAhBA,UAAgB,eACjEhB,QAAQ,CAAC,KAAD,CADyD,wCACjGiB,YADiG,eACnFC,cADmF,eAGxG,QAASC,CAAAA,YAAT,EAAwB,CACpBN,cAAc,CAACD,KAAK,CAACQ,EAAP,CAAd,CACAF,cAAc,CAAC,IAAD,CAAd,CACH,CAED,QAASG,CAAAA,cAAT,EAA0B,CACtBH,cAAc,CAAC,KAAD,CAAd,CACAH,cAAc,CAACH,KAAD,CAAd,CACH,CAED,mBACI,0BAAI,SAAS,CAAE,QAAUK,YAAY,CAAG,gBAAH,CAAqB,EAA3C,CAAf,eACI,2BAAK,SAAS,CAAC,iBAAf,eACI,2BAAK,SAAS,CAAC,YAAf,eACI,6BAAO,SAAS,CAAE,KAAOL,KAAK,CAACU,SAAN,CAAkB,WAAlB,CAAgC,EAAvC,CAAlB,CAA8D,IAAI,CAAC,UAAnE,CAA8E,QAAQ,CAAE,0BAAMP,CAAAA,cAAc,CAACH,KAAD,CAApB,EAAxF,EADJ,CADJ,cAKI,2BAAK,SAAS,CAAC,YAAf,eACI,4CACI,0BAAI,SAAS,CAAE,eAAiBA,KAAK,CAACU,SAAN,CAAkB,cAAlB,CAAkC,EAAnD,CAAf,EACKV,KAAK,CAACW,KADX,CADJ,CAIKN,YAAY,GAAK,KAAjB,eACG,yBAAG,SAAS,CAAC,2BAAb,EACKT,eAAe,CAACI,KAAK,CAACY,SAAP,CADpB,CALR,CADJ,CALJ,cAkBI,2BAAK,SAAS,CAAC,aAAf,eAEI,oBAAC,UAAD,EAAY,KAAK,CAAEZ,KAAnB,CAA0B,YAAY,CAAEO,YAAxC,CAAsD,YAAY,CAAE,8BAAMD,CAAAA,cAAc,CAAC,KAAD,CAApB,EAApE,CAAiG,cAAc,CAAEG,cAAjH,EAFJ,CAIKJ,YAAY,GAAK,KAAjB,eACD,2BAAK,SAAS,CAAE,eAAiBL,KAAK,CAACU,SAAN,CAAkB,WAAlB,CAA+B,EAAhD,CAAhB,CAAqE,OAAO,CAAE,iBAAAG,CAAC,QAAIT,CAAAA,UAAU,CAACJ,KAAD,CAAd,EAA/E,eACI,yBAAG,IAAI,CAAC,IAAR,eACI,4BAAM,SAAS,CAAC,uBAAhB,eACI,yBAAG,SAAS,CAAC,aAAb,EADJ,CADJ,CADJ,CALJ,cAcI,2BAAK,SAAS,CAAC,YAAf,eACI,yBAAG,IAAI,CAAC,IAAR,CAAa,OAAO,CAAE,iBAAAa,CAAC,QAAIX,CAAAA,YAAY,CAACF,KAAD,CAAhB,EAAvB,eACI,4BAAM,SAAS,CAAC,sBAAhB,eACI,yBAAG,SAAS,CAAC,oBAAb,EADJ,CADJ,CADJ,CAdJ,CAlBJ,CADJ,CADJ,CA+CH,CA5DmC,CAApC,CA8DA,GAAMc,CAAAA,iBAAiB,CAAGvB,iBAAiB,CAAC,eAAqE,IAAnEwB,CAAAA,KAAmE,OAAnEA,KAAmE,CAA5DC,WAA4D,OAA5DA,WAA4D,CAA/Cd,YAA+C,OAA/CA,YAA+C,CAAjCC,cAAiC,OAAjCA,cAAiC,CAAjBC,UAAiB,OAAjBA,UAAiB,CAE7G,QAASa,CAAAA,aAAT,CAAuBC,MAAvB,CAA+B,CAC3B,GAAIC,CAAAA,KAAK,CAAGJ,KAAK,CAACK,SAAN,CAAgB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACb,EAAF,GAASU,MAAb,EAAjB,CAAZ,CACAF,WAAW,CAACG,KAAD,CAAX,CACH,CAED,mBACA,8BACKJ,KAAK,CAACO,GAAN,CAAU,SAACtB,KAAD,CAAQmB,KAAR,qBACP,oBAAC,YAAD,EAAc,GAAG,CAAEnB,KAAK,CAACQ,EAAzB,CAA6B,KAAK,CAAEW,KAApC,CAA2C,KAAK,CAAEnB,KAAlD,CAAyD,cAAc,CAAEiB,aAAzE,CAAwF,YAAY,CAAEf,YAAtG,CAAoH,cAAc,CAAEC,cAApI,CAAoJ,UAAU,CAAEC,UAAhK,EADO,EAAV,CADL,CADA,CAOH,CAd0C,CAA3C,CAiBA;AACA,MAAO,IAAMmB,CAAAA,UAAU,CAAGpC,KAAK,CAACqC,aAAN,CAAoB,KAApB,CAAnB,CAEP,cAAe,SAASC,CAAAA,YAAT,OAAiG,IAAzEC,CAAAA,cAAyE,OAAzEA,cAAyE,CAAzDC,kBAAyD,OAAzDA,kBAAyD,CAArCvB,UAAqC,OAArCA,UAAqC,CAAzBwB,aAAyB,OAAzBA,aAAyB,CAAVC,MAAU,OAAVA,MAAU,gBAClFzC,QAAQ,CAAC,EAAD,CAD0E,yCACrG0C,KADqG,eAC9FC,QAD8F,8BAEhF3C,QAAQ,CAAC,KAAD,CAFwE,yCAErG4C,MAFqG,eAE7FC,SAF6F,eAG5G,GAAMC,CAAAA,WAAW,CAAG,CAACF,MAAM,CAANA,MAAD,CAASC,SAAS,CAATA,SAAT,CAApB,CACA,GAAME,CAAAA,cAAc,CAAG7C,MAAM,CAAC,IAAD,CAA7B,CAJ4G,eAK5EF,QAAQ,CAAC,IAAD,CALoE,yCAKrGgD,SALqG,eAK1FC,UAL0F,eAO5G,GAAMC,CAAAA,UAAU,2FAAG,oJACTC,GADS,CACHzC,QAAQ,CAAG,gBAAX,EAA+B6B,kBAAkB,CAAG,YAAH,CAAkB,SAAnE,CADG,uCAGYa,CAAAA,KAAK,CAACD,GAAD,CAHjB,QAGLE,QAHK,+CAIJA,QAAQ,CAACC,EAAT,CAAcD,QAAQ,CAACE,IAAT,EAAd,CAAgC,IAJ5B,0DAMXC,OAAO,CAACC,GAAR,cANW,gCAOJ,IAPI,sEAAH,kBAAVP,CAAAA,UAAU,2CAAhB,CAWA,QAASQ,CAAAA,WAAT,CAAqBC,IAArB,CAA2B,CACvB,GAAIC,CAAAA,UAAU,CAAGtD,SAAS,CAAC,WAAD,CAA1B,CAEAqD,IAAI,CAACE,OAAL,CAAa,SAACC,IAAD,CAAO/B,KAAP,CAAiB,CAC1B+B,IAAI,CAACC,KAAL,CAAahC,KAAb,CACAxB,UAAU,CAACuD,IAAD,CAAOF,UAAP,CAAV,CACH,CAHD,EAIH,EAED3D,SAAS,CAAC,UAAM,CACZ,OAAOwC,MAAP,EACI,QACI,MACJ,IAAK,SAAL,CACI,GAAIuB,CAAAA,MAAM,oBAAOtB,KAAP,CAAV,CACAsB,MAAM,CAACC,IAAP,CAAY,SAACC,CAAD,CAAIC,CAAJ,QAAWD,CAAAA,CAAC,CAAC1C,SAAF,CAAc2C,CAAC,CAAC3C,SAAjB,CAA8B,CAA9B,CAAoC2C,CAAC,CAAC3C,SAAF,CAAc0C,CAAC,CAAC1C,SAAjB,CAA8B,CAAC,CAA/B,CAAmC,CAAhF,EAAZ,EACAmB,QAAQ,CAACqB,MAAD,CAAR,CACA,MACJ,IAAK,UAAL,CACI,GAAIA,CAAAA,MAAM,oBAAOtB,KAAP,CAAV,CACAsB,MAAM,CAACC,IAAP,CAAY,SAACC,CAAD,CAAIC,CAAJ,QAAWD,CAAAA,CAAC,CAAC1C,SAAF,CAAc2C,CAAC,CAAC3C,SAAjB,CAA8B,CAA9B,CAAoC2C,CAAC,CAAC3C,SAAF,CAAc0C,CAAC,CAAC1C,SAAjB,CAA8B,CAAC,CAA/B,CAAmC,CAAhF,EAAZ,EACAmB,QAAQ,CAACqB,MAAD,CAAR,CACA,MAZR,CAcH,CAfQ,CAeN,CAACvB,MAAD,CAfM,CAAT,CAiBA;AACAxC,SAAS,CAAC,UAAM,CACZ,GAAI8C,cAAc,CAACqB,OAAnB,CAA4B,CACxBrB,cAAc,CAACqB,OAAf,CAAyB,KAAzB,CACH,CAFD,IAEO,CACHlB,UAAU,GAAGmB,IAAb,CAAkB,SAAAV,IAAI,CAAI,CACtBA,IAAI,CAACM,IAAL,CAAU,SAACC,CAAD,CAAIC,CAAJ,QAAWD,CAAAA,CAAC,CAACH,KAAF,CAAUI,CAAC,CAACJ,KAAb,CAAsB,CAAtB,CAA4BI,CAAC,CAACJ,KAAF,CAAUG,CAAC,CAACH,KAAb,CAAsB,CAAC,CAAvB,CAA2B,CAAhE,EAAV,EACA,GAAIhC,CAAAA,KAAK,CAAG4B,IAAI,CAAC3B,SAAL,CAAe,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACV,KAAF,GAAYe,cAAc,CAACf,KAA/B,EAAhB,CAAZ,CACAoC,IAAI,CAAGtD,SAAS,CAACsD,IAAD,CAAO5B,KAAP,CAAc,CAAd,CAAhB,CACA4B,IAAI,CAACE,OAAL,CAAa,SAACjD,KAAD,CAAQqB,CAAR,CAAc,CACvBrB,KAAK,CAACmD,KAAN,CAAc9B,CAAd,CACH,CAFD,EAGAU,QAAQ,CAACgB,IAAD,CAAR,CACAD,WAAW,CAACC,IAAD,CAAX,CACH,CATD,EAUH,CAEJ,CAhBQ,CAgBN,CAACrB,cAAD,CAhBM,CAAT,CAkBArC,SAAS,CAAC,UAAM,CAEZiD,UAAU,GACTmB,IADD,CACM,SAAAV,IAAI,CAAI,CACVA,IAAI,CAACM,IAAL,CAAU,SAACC,CAAD,CAAIC,CAAJ,QAAWD,CAAAA,CAAC,CAACH,KAAF,CAAUI,CAAC,CAACJ,KAAb,CAAsB,CAAtB,CAA4BI,CAAC,CAACJ,KAAF,CAAUG,CAAC,CAACH,KAAb,CAAsB,CAAC,CAAvB,CAA2B,CAAhE,EAAV,EACApB,QAAQ,CAACgB,IAAD,CAAR,CACAV,UAAU,CAAC,KAAD,CAAV,CACC,CALL,EAOH,CATQ,CASN,CAACT,aAAD,CATM,CAAT,CAWA,GAAM8B,CAAAA,SAAS,CAAI,QAAbA,CAAAA,SAAa,OAA0B,IAAxBC,CAAAA,QAAwB,OAAxBA,QAAwB,CAAdC,QAAc,OAAdA,QAAc,CACzC,GAAIC,CAAAA,QAAQ,oBAAO/B,KAAP,CAAZ,CACA+B,QAAQ,CAAGpE,SAAS,CAACoE,QAAD,CAAWF,QAAX,CAAqBC,QAArB,CAApB,CAEAd,WAAW,CAACe,QAAD,CAAX,CACA9B,QAAQ,CAAC8B,QAAD,CAAR,CAEH,CAPD,CASA,QAASC,CAAAA,UAAT,CAAoBjD,CAApB,CAAuB,CACnB,GAAIkD,CAAAA,QAAQ,CAAGjC,KAAK,CAACkC,MAAN,CAAa,SAAA3C,CAAC,QAAIA,CAAAA,CAAC,CAACb,EAAF,GAASK,CAAC,CAACL,EAAf,EAAd,CAAf,CACAuB,QAAQ,CAACgC,QAAD,CAAR,CAEA,GAAIf,CAAAA,UAAU,CAAGtD,SAAS,CAAC,WAAD,CAA1B,CACA,GAAI6C,CAAAA,GAAG,CAAGzC,QAAQ,CAAG,kBAAX,CAAgCe,CAAC,CAACL,EAAlC,CAAuC,GAAjD,CAEAgC,KAAK,CAACD,GAAD,CAAM,CACP0B,MAAM,CAAE,QADD,CAEPC,OAAO,CAAE,CACL,eAAgB,kBADX,CAEL,cAAelB,UAFV,CAFF,CAAN,CAAL,CAOH,CAED,QAASmB,CAAAA,cAAT,EAA0B,CACtB,GAAIC,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,EAAX,CACA,GAAIC,CAAAA,EAAE,CAAGC,MAAM,CAACH,IAAI,CAACI,OAAL,EAAD,CAAN,CAAuBC,QAAvB,CAAgC,CAAhC,CAAkC,GAAlC,CAAT,CACA,GAAIC,CAAAA,EAAE,CAAGH,MAAM,CAACH,IAAI,CAACO,QAAL,GAAkB,CAAnB,CAAN,CAA4BF,QAA5B,CAAqC,CAArC,CAAuC,GAAvC,CAAT,CACA,GAAIG,CAAAA,IAAI,CAAGR,IAAI,CAACS,WAAL,EAAX,CAEA,GAAIC,CAAAA,KAAK,CAAGF,IAAI,CAAG,GAAP,CAAaF,EAAb,CAAkB,GAAlB,CAAwBJ,EAApC,CACA,MAAOQ,CAAAA,KAAP,CACH,CAED,QAASC,CAAAA,kBAAT,CAA4BlE,CAA5B,CAA+B,CAC3B,GAAIM,CAAAA,KAAK,CAAGW,KAAK,CAACV,SAAN,CAAgB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACb,EAAF,GAASK,CAAC,CAACL,EAAf,EAAjB,CAAZ,CACA,GAAIwE,CAAAA,OAAO,oBAAOlD,KAAP,CAAX,CACAkD,OAAO,CAAC7D,KAAD,CAAP,CAAeT,SAAf,CAA2B,IAA3B,CACAsE,OAAO,CAAC7D,KAAD,CAAP,CAAe8D,WAAf,CAA6Bd,cAAc,EAA3C,CACA,GAAInB,CAAAA,UAAU,CAAGtD,SAAS,CAAC,WAAD,CAA1B,CAEAqC,QAAQ,CAACiD,OAAD,CAAR,CACArF,UAAU,CAACqF,OAAO,CAAC7D,KAAD,CAAR,CAAiB6B,UAAjB,CAAV,CACH,CAED,QAASkC,CAAAA,SAAT,CAAmBC,SAAnB,CAA8B,CAC1B,GAAItB,CAAAA,QAAQ,CAAGpE,SAAS,CAACqC,KAAD,CAAQqD,SAAR,CAAmB,CAAnB,CAAxB,CACApD,QAAQ,CAAC8B,QAAD,CAAR,CACH,EAED,mBACI,wCAECzB,SAAS,GAAK,IAAd,eACD,2BAAK,SAAS,CAAC,cAAf,eAA8B,+BAA9B,cAAyC,+BAAzC,cAAoD,+BAApD,cAA+D,+BAA/D,CAHA,CAMCA,SAAS,GAAK,KAAd,eACD,oBAAC,UAAD,CAAY,QAAZ,EAAqB,KAAK,CAAEF,WAA5B,eACI,oBAAC,iBAAD,EAAmB,KAAK,CAAEJ,KAA1B,CAAiC,SAAS,CAAE4B,SAA5C,CAAuD,WAAW,CAAEwB,SAApE,CAA+E,YAAY,CAAEpB,UAA7F,CAAyG,cAAc,CAAEiB,kBAAzH,CAA6I,UAAU,CAAE3E,UAAzJ,EADJ,CAPA,CADJ,CAcH","sourcesContent":["import React, {useState, useEffect, useRef} from 'react'\nimport {SortableContainer, SortableElement} from 'react-sortable-hoc';\nimport arrayMove from 'array-move';\nimport {getCookie, taskUpdate,fancyTimeFormat} from './utils'\nimport {StartTimer} from './Timer'\nimport {BASE_URL} from './../App'\n\n\nconst SortableItem = SortableElement(({value, onActivateTask, onDeleteTask, onFinishedTask, onEditTask}) => {\n    const [active_style, setActiveStyle] = useState(false)\n\n    function timerStarted() {\n        onActivateTask(value.id);\n        setActiveStyle(true);\n    }\n\n    function markAsComplete() {\n        setActiveStyle(false);\n        onFinishedTask(value);\n    }\n\n    return (\n        <li className={\"box \" + (active_style ? 'task-is-active': '')}>\n            <div className=\"level is-mobile\">\n                <div className=\"level-left\">\n                    <input className={\" \" + (value.completed ? 'is-hidden' : '')} type=\"checkbox\" onChange={() => onFinishedTask(value)}/>\n                </div>\n\n                <div className=\"level-item\">\n                    <div>\n                        <h1 className={\"title is-5 \" + (value.completed ? 'is-completed': '')}>\n                            {value.title}\n                        </h1>\n                        {active_style === false &&                         \n                            <p className=\"is-help has-text-centered\">\n                                {fancyTimeFormat(value.remaining)}\n                            </p>\n                        }\n                    </div>\n                </div>\n\n                <div className=\"level-right\">\n\n                    <StartTimer value={value} onTimerStart={timerStarted} onTimerPause={() => setActiveStyle(false)} markAsComplete={markAsComplete}/>\n\n                    {active_style === false &&                     \n                    <div className={\"level-item \" + (value.completed ? 'is-hidden': '')} onClick={e => onEditTask(value)}>\n                        <a href=\"#/\">\n                            <span className=\"icon has-text-warning\">\n                                <i className=\"fas fa-edit\"></i>\n                            </span>\n                        </a>\n                    </div>\n                    }\n\n                    <div className=\"level-item\">\n                        <a href=\"#/\" onClick={e => onDeleteTask(value)}>\n                            <span className=\"icon has-text-danger\">\n                                <i className=\"fas fa-lg fa-times\"></i>\n                            </span>\n                        </a>\n                    </div>\n\n                </div>\n\n            </div>\n        </li>\n    )\n});\n\nconst SortableComponent = SortableContainer(({items, onFocusTask, onDeleteTask, onFinishedTask, onEditTask }) => {\n\n    function setActiveTask(taskId) {\n        var index = items.findIndex(i => i.id === taskId);\n        onFocusTask(index);\n    }\n\n    return (\n    <ul>\n        {items.map((value, index) => (\n            <SortableItem key={value.id} index={index} value={value} onActivateTask={setActiveTask} onDeleteTask={onDeleteTask} onFinishedTask={onFinishedTask} onEditTask={onEditTask}/>\n        ))}\n    </ul>\n    )\n})\n\n\n// Context for setting active tasks\nexport const ActiveTask = React.createContext(false)\n\nexport default function SortableList({ newTaskCreated, completedTasksList, onEditTask, onUpdateTasks, onSort }) {\n    const [tasks, setTasks] = useState([]);\n    const [active, setActive] = useState(false);\n    const active_task = {active, setActive};\n    const isInitialMount = useRef(true);\n    const [isLoading, setLoading] = useState(true);\n\n    const fetchTasks = async () => {\n        const url = BASE_URL + 'api/task-list/' + (completedTasksList ? 'completed/' : 'active/')\n        try {\n            const response = await fetch(url);\n            return response.ok ? response.json() : null;\n        } catch (error) {\n            console.log(error);\n            return null;\n        }\n    }\n\n    function updateIndex(data) {\n        var csrf_token = getCookie('csrftoken');\n        \n        data.forEach((task, index) => {\n            task.order = index;\n            taskUpdate(task, csrf_token);\n        });\n    };\n\n    useEffect(() => {\n        switch(onSort) {\n            default:\n                break;\n            case 'longest':\n                var sorted = [...tasks];\n                sorted.sort((a, b) => (a.remaining < b.remaining) ? 1 : ((b.remaining < a.remaining) ? -1 : 0));\n                setTasks(sorted);\n                break;\n            case 'shortest':\n                var sorted = [...tasks];\n                sorted.sort((a, b) => (a.remaining > b.remaining) ? 1 : ((b.remaining > a.remaining) ? -1 : 0));\n                setTasks(sorted);\n                break;\n        }\n    }, [onSort])\n\n    //Update list when new task is created\n    useEffect(() => {\n        if (isInitialMount.current) {\n            isInitialMount.current = false;\n        } else {\n            fetchTasks().then(data => {\n                data.sort((a, b) => (a.order > b.order) ? 1 : ((b.order > a.order) ? -1 : 0));\n                var index = data.findIndex(i => i.title === newTaskCreated.title);\n                data = arrayMove(data, index, 0);\n                data.forEach((value, i) => {\n                    value.order = i;\n                })\n                setTasks(data);\n                updateIndex(data);\n            })\n        }\n\n    }, [newTaskCreated])\n\n    useEffect(() => {\n        \n        fetchTasks()\n        .then(data => {\n            data.sort((a, b) => (a.order > b.order) ? 1 : ((b.order > a.order) ? -1 : 0));\n            setTasks(data);\n            setLoading(false);\n            }\n        );\n    }, [onUpdateTasks]);\n\n    const onSortEnd =  ({oldIndex, newIndex}) => {\n        var newOrder = [...tasks];\n        newOrder = arrayMove(newOrder, oldIndex, newIndex);\n                        \n        updateIndex(newOrder);\n        setTasks(newOrder);\n\n    };\n\n    function deleteTask(e) {\n        var newTasks = tasks.filter(i => i.id !== e.id);\n        setTasks(newTasks);\n\n        var csrf_token = getCookie('csrftoken');\n        var url = BASE_URL + 'api/task-delete/' + e.id + '/';\n\n        fetch(url, {\n            method: 'DELETE',\n            headers: {\n                'Content-Type': 'application/json',\n                'X-CSRFToken': csrf_token,\n            }\n        });\n    }\n\n    function getCurrentDate() {\n        var date = new Date();\n        var dd = String(date.getDate()).padStart(2,'0');\n        var mm = String(date.getMonth() + 1).padStart(2,'0');\n        var year = date.getFullYear();\n\n        var today = year + '-' + mm + '-' + dd;\n        return today;\n    }\n\n    function markTaskAsComplete(e) {\n        var index = tasks.findIndex(i => i.id === e.id)\n        var updates = [...tasks];\n        updates[index].completed = true;\n        updates[index].finish_date = getCurrentDate();\n        var csrf_token = getCookie('csrftoken')\n\n        setTasks(updates);\n        taskUpdate(updates[index], csrf_token);\n    }\n\n    function focusTask(taskIndex) {\n        var newOrder = arrayMove(tasks, taskIndex, 0);\n        setTasks(newOrder)\n    };\n\n    return (\n        <>\n        \n        {isLoading === true && \n        <div className=\"lds-ellipsis\"><div></div><div></div><div></div><div></div></div>\n        }\n\n        {isLoading === false && \n        <ActiveTask.Provider value={active_task}>\n            <SortableComponent items={tasks} onSortEnd={onSortEnd} onFocusTask={focusTask} onDeleteTask={deleteTask} onFinishedTask={markTaskAsComplete} onEditTask={onEditTask}/>\n        </ActiveTask.Provider>\n        }\n        </>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}